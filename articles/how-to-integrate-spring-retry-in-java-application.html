<!DOCTYPE html>
<html lang="en-US">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Top 4 Ways Integrate Spring Retry with Your Java Application</title>
<meta name="description" content="In this article, Top 4 way to integrate Java application using spring retry library or module facility where we have to method calling where some Runtime exception is sometimes expected and we have to spring to enable retry config." />
<meta name="keywords" content="Spring Retry library, Rest API, Java Application Development" />
<link rel="canonical" href="https://www.nexsoftsys.com/articles/how-to-integrate-spring-retry-in-java-application.html" />

<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Top 4 Ways Integrate Spring Retry with Your Java Application" />
<meta property="og:description" content="In this article, Top 4 way to integrate Java application using spring retry library or module facility where we have to method calling where some Runtime exception is sometimes expected and we have to spring to enable retry config." />
<meta property="og:url" content="https://www.nexsoftsys.com/articles/how-to-integrate-spring-retry-in-java-application.html" />
<meta property="og:site_name" content="NEX Softsys" />
<meta property="article:publisher" content="https://www.facebook.com/NexSoftSys/" />
<meta property="article:section" content="Trending" />
<meta property="og:image" content="https://www.nexsoftsys.com/images/spring2.jpg" />
<meta property="og:image:secure_url" content="https://www.nexsoftsys.com/images/spring2.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="In this article, Top 4 way to integrate Java application using spring retry library or module facility where we have to method calling where some Runtime exception is sometimes expected and we have to spring to enable retry config." />
<meta name="twitter:title" content="Top 4 Ways Integrate Spring Retry with Your Java Application" />
<meta name="twitter:site" content="@nexsoftsys" />
<meta name="twitter:image" content="https://www.nexsoftsys.com/images/spring2.jpg" />
<meta name="twitter:creator" content="@nexsoftsys" />

<link type="image/x-icon" href="../images/favicon.ico" rel="shortcut icon" />
<link rel="apple-touch-icon" sizes="57x57" href="../images/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="../images/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="../images/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="../images/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="../images/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="../images/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="../images/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="../images/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192" href="../images/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="../images/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png" />
<link rel="manifest" href="../images/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="images/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-64517863-1', 'auto');
		ga('send', 'pageview');
	</script><!-- Google Analytics /- -->
	
	<!-- Library -->
	<link rel="stylesheet" type="text/css" href="../css/lib.css">
	
	<!-- Custom - Common CSS -->
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<link rel="stylesheet" type="text/css" href="../css/navigation.css">
	<link rel="stylesheet" type="text/css" href="../style.css"/>
<noscript>
<div class="ndiv">
<div class="ntext">
<b>JavaScript Required</b>
<p>We're sorry, but we doesn't work properly without JavaScript enabled.</p>
</div>
</div>
</noscript>
</head>

<body>
	<!-- Header Section -->
	<div id="return-to-top"><i class="fa fa-angle-up"></i></div>

    <header class="header_s">
        <!-- ===== Popup Box ===== -->
        <section class="top-box">
            <div class="container">
                <div class="row">
                    <div class="col-12 same-line">
                        <div class="contain-box">
                            <p>Looking for an Expert Development Team? Take two weeks Trial! <a href="javascript:;" id="myBtn">Try Now</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="modal" id="myModal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close">&times;</span>
                    <strong>Free 2 Week Trial</strong>
                </div>
                <div class="modal-form">
                    <form>
                        <div class="form-group">
                            <label>Your Name *</label>
                            <input type="text" name="question-title" class="form-control" id="txt2Name" placeholder="Your Name" />
                        </div>
                        <div class="form-group">
                            <label>Your Email *</label>
                            <input type="text" name="question-title" class="form-control" id="txt2Email" placeholder="Your Email" />
                        </div>
                        <div class="form-group">
                            <label>Your Mobile *</label>
                            <input type="text" name="question-title" class="form-control" id="txt2Phone" placeholder="Your Mobile" />
                        </div>
                        <div class="form-group">
                            <label>Subject</label>
                            <input type="text" name="question-title" class="form-control" id="txt2Subject" placeholder="Subject" />
                            <input type="hidden" id="txt2Page" value="" />
                        </div>
                        <div class="form-group">
                            <label>Your Message</label>
                            <textarea class="form-control" cols="5" rows="5" placeholder="Your Message" id="txt2Message" name="message"></textarea>
                        </div>
                        <div class="form-group">
                            

<img id="imgCaptchaRFP" alt="captcha" src="" class="captcha-style" />
                            <input class="form-control captcha-txt" type="text" placeholder="Captcha" id="txt2Captcha" name="txtCaptcha" />
                        </div>
                    </form>
                </div>
                <div class="modal-footer text-center">
                    <button type="button" id="btn2WeekSubmit" value="Send" name="Submit">Send</button>
                    <p><span id="lbl2WeekInfo" class="lblblack"></span></p>
                </div>
            </div>
        </section>
        <!-- # -->
		<div class="container-fluid">
			<div class="menu-block">
                <div class="mobile-sticky-footer">
                    <a target="_blank" class="skype" href="skype:aegissoftware?call"><i class="fa fa-fw" aria-hidden="true" title="Skype"></i></a>
                    <a target="_blank" class="whatsapp" href="https://api.whatsapp.com/send?phone=919824127020&text=Hi&sbquo;&nbsp;I&nbsp;am&nbsp;Connect&nbsp;through&nbsp;your&nbsp;website"><i class="fa fa-fw" aria-hidden="true" title="Whatsapp"></i></a>
                    <a target="_blank" class="inquiry" href="tel:+16469710799"><i class="fa fa-fw" aria-hidden="true" title="Phone"></i></a>
                    <a target="_blank" class="case-studies" href="mailto:info@nexsoftsys.com"><i class="fa fa-fw" aria-hidden="true" title="Email"></i></a>
                    <a href="../rfp.html" class="client-speaks"><i class="fa fa-fw" aria-hidden="true" title="RFP"></i></a>
                </div>	
				<div class="container">	
					<nav class="menu-navigation">
						<div class="logo-block">
							<a class="navbar-brand" href="/">
								<img src="../images/logo.png" alt="logo"/>
							</a>
						</div>
						<a class="menuswitch" href="#">
							<span class="menuline bar1"></span>
							<span class="menuline bar2"></span>
							<span class="menuline bar3"></span>
						</a>
						<div class="menu-collapse">
							<ul class="navigation-menu">
								<li><a href="/">Home</a></li>
								<li><a href="../company.html">About Us</a></li>
								<li class="dropdown">
									<i class="ddl-switch"></i>
									<a href="#">Services</a>
									<ul class="dropdown-menu">
										<div class="dropdown-menubox">
											<li><a href="../services/application-development.html">Application Development</a></li>
											<li><a href="#">Digital Transformation</a></li>
											<li><a href="../services/software-consulting-services.html">Software Consulting Services</a></li>
											<li><a href="../services/software-it-outsourcing-services.html">Software IT Outsourcing</a></li>
											<li><a href="../services/offshore-development-center.html">Offshore Development</a></li>
										</div>
										<div class="dropdown-menubox">
											<li><a href="../services/big-data-services.html">Big Data</a></li>
											<li><a href="../services/real-time-data-analytics-services.html">Real Time Analytics</a></li>
											<li><a href="#">Block Chain</a></li>
											<li><a href="../services/devops-consulting.html">DevOps</a></li>
											<li><a href="../services/offshore-qa-testing-services.html">QA and Testing Services</a></li>
										</div>
										<div class="dropdown-menubox">
											<li><a href="../services/amazon-cloud-services.html">Amazon Cloud Services</a></li>
											<li><a href="../services/cloud-application-development.html">Cloud Application</a></li>
											<li><a href="../services/mobility-solutions.html">Enterprise Mobility</a></li>
											<li><a href="#">Business Intelligence</a></li>
										</div>
										<div class="dropdown-menubox">
											<li><a href="../services/data-warehousing-solutions.html">Data ware Housing</a></li>
											<li><a href="#">Data Integration</a></li>
											<li><a href="../services/ETL-data-integration-services.html">ETL</a></li>
											<li><a href="#">Dashboards</a></li>
										</div>
									</ul>
								</li>
								<li class="dropdown">
									<i class="ddl-switch"></i>
									<a href="#">Technologies</a>
									<ul class="dropdown-menu two_col">
										<div class="dropdown-menubox">
											<li><a href="../technologies/java-application-development.html">Java</a></li>
											<li><a href="../technologies/python-development-services.html">Python</a></li>
											<li><a href="../technologies/scala-development.html">Scala</a></li>
											<li><a href="../technologies/magento-ecommerce.html">Magento</a></li>
										</div>
										<div class="dropdown-menubox">
											<li><a href="../technologies/android-app-development.html">Android</a></li>
											<li><a href="../technologies/ios-application-development.html">iOS</a></li>
											<li><a href="../technologies/pentaho-BI-Services.html">Pentaho BI</a></li>
										</div>
										<div class="dropdown-menubox microsoft_nested">
											<li class="full_width"><strong>Microsoft</strong></li>
											<li><a href="../technologies/net-application-development.html">.Net Development</a></li>
											<li><a href="../technologies/microsoft-dynamics-365.html">Dynamics 365</a></li>
											<li><a href="../technologies/dynamics-365-business-central-solutions-development.html">Dynamics 365 Business Central</a></li>
											<li><a href="../technologies/dynamics365-finance-and-operations.html">Dynamics 365 Finance &amp; Operations</a></li>
											<li><a href="../technologies/microsoft-dynamics-crm-consulting.html">Dynamics CRM</a></li>
											<li><a href="#">Power BI</a></li>
										</div>
									</ul>
								</li>
                                <li><a href="/articles/">Blog</a></li>
                                <li><a href="../contact.html" class="menu-box">Contact Us</a></li>
							</ul>
						</div>
					</nav>
				</div>
			</div>
		</div>
	</header><!-- Header Section /- -->
    
    <div class="b-notification-bar">
            <!-- Social Links -->
            <ul class="btnlist">
                <li class="item skype">
                    <a href="skype:aegissoftware?call">
                        <div class="sticky-box">
                            <p><i class="fa fa-skype"></i></p>
                            <p>Skype</p>
                        </div>
                    </a>
                </li>
            </ul>
            <!-- # Social Links -->

            <!-- Inquiry Form -->
            <ul class="btnlist">
                <li class="item inquiry">
                    <div id="inquiry_form" class="btn sticky-box">
                        <p><i class="fa fa-envelope" aria-hidden="true"></i></p>
                        <p>Quick Inquiry</p>
                    </div>
                    <div class="info-box inq">
                        <img src="images/close-icon.png" class="closeInquiry" alt="close" />
                        <strong class="title">Fill the details and We’ll get back to you soon</strong>
                        <form>
                            <div class="inquiry-box">
                                <div class="form-group fullwidth">
                                    <textarea class="form-control" id="txtcomments" placeholder="Tell us your requirements"></textarea>
                                </div>
                                <div class="form-group-block">
                                    <div class="form-group">
                                        <input class="form-control" id="txtphone" placeholder="Phone" type="text" onkeydown="javascript:backspacerDOWN(this, event);" onkeyup="javascript:backspacerUP(this, event);">
                                    </div>
                                    <div class="form-group">
                                        <input class="form-control" id="txtemail" placeholder="Email" type="email">
                                    </div>
                                    <div class="form-group">
                                        <input class="form-control" id="txtskype" placeholder="Skype" type="text">
                                    </div>
                                    <div class="form-group">
                                        <img id="imgCaptcha" alt="captcha" src="/Captcha.ashx" />
                                        <input class="form-control" type="text" placeholder="Captcha" id="txtCaptcha" name="txtCaptcha" />
                                    </div>
                                    <div class="form-group Clear">
                                        <button type="button" id="btnSubmit" value="Submit" name="Submit" class="btn-submit">Submit</button>
                                    </div>
                                    <div class="form-group Clear">
                                        <span id="lblInfo"> </span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>
            </ul><!-- Inquiry Form /- -->
            <!--Btns-->
            <ul class="btnlist">
                <li class="item case-studies">
                    <div class="btn sticky-box" onClick="window.location.href='../casestudy/java/java-case-studies.html'">
                        <p><i class="fa fa-check-square-o" aria-hidden="true"></i></p>
                        <p>Case Studies</p>
                    </div>
                </li>
                <li class="item client-speaks">
                    <div class="btn sticky-box" onClick="window.location.href='../testimonials/java-testimonials.html'">
                        <p><i class="fa fa-smile-o" aria-hidden="true"></i></p>
                        <p>Client Speaks</p>
                    </div>
                </li>
            </ul><!--Btns-->
        </div>
        <div class="Inner-Banner">
    	<div class="Page-Size">
            	<h1>How to integrate Spring Retry in Java Application</h1>
            </div>
        </div><!--Web-Banner-->
    
    <div class="Page-Size">
        <div class="Text Width-100">
			<h3>1. Introduction</h3>
			<p>In a business application, we often come across the use-cases, where we need to access a resource whose access is unreliable.
If the initial access fails, then ideally we retry the failed operation (hoping it might succeed in the subsequent attempt).
Also we need a fallback mechanism in case all our retries fail.
</p>
	<p>Common examples include accessing a remote web-service/RMI (network outage, server down, network glitch, deadlock)</p>
			<p>Spring Retry library <a href="https://github.com/spring-projects/spring-retry">(https://github.com/spring-projects/spring-retry)</a> provides a declarative support to retry failed operations as well as fallback mechanism in case all the attempts fail.</p>
			<p>This article will explain step by step setup for integrate spring-retry in our spring-boot application.</p>
			<h3>2. Project</h3>
			<p><b>2.1 Project Structure</b></p>
			<p>We will be creating a spring-boot maven project.
				The project layout is as follows :
				</p>
			
			<xmp>
└───maven-project
    ├───pom.xml
    └───src
       ├───main
        │   ├───java (java source files)
        │   ├───resources (properties files)
			</xmp>
			<p>The project structure screenshot is as follows :</p>
			
			<div class="single-article-img"><img src="../images/spring2.jpg" alt="spring"/></div>
			<p><b>2.2 Project High Level Diagram :</b></p>
			<div class="single-article-img"><img src="../images/spring3.jpg" alt="spring"/></div>
			<p><b>Explanation :</b></p>
			<p>1.	The project has RemoteClientService and its dummy implementation, which mimics the real world unreliable service (It works 25% of time and throws RemoteException the remaining times)</p>
			<p>2.	The ApplicationService accesses the APIs of RemoteClientService and have the retryable context on it (ie if the access fails, then retry accessing it again as per retry configuration).</p>
			<p>3.	The LookupController exposes the rest API of our application, where we get a key as request param and return ait along with its value.</p>
			<h3>2.3 Maven dependencies:</h3>
			<p>The pom.xml file for our project is as follows :</p>
			<xmp>
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.hemant</groupId>
	<artifactId>spring-retry</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<packaging>jar</packaging>

	<name>spring-retry</name>
	<description>Demo project for Spring Boot</description>

	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>1.5.1.RELEASE</version>
		<relativePath />
	</parent>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
		<java.version>1.8</java.version>
	</properties>

	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.retry</groupId>
			<artifactId>spring-retry</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-aspects</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>

</project>
		</xmp>
		<p><b>2.3 Project Details </b></p>
		<p>The code for the same is as follows :</p>
		<p>2.3.1 RemoteClientService</p>
		<p>The RemoteClientService and its implementation is as follows :</p>
<xmp>
packagecom.hemant.springretry.service.remote;
</xmp>

<xmp>
	importjava.util.Map;
/**
 * This service represents a remote webservice/RMI
 * whose response is not guaranteed.
 * @author hemant
 *
 */
publicinterfaceRemoteClientService {

	Map<String, String>getValueForKey(String key);

}
</xmp>

<p>The dummy implementation of the RemoteClientService which mimics real world unreliable access is as follows :</p>

<xmp>
packagecom.hemant.springretry.service.remote;

importjava.util.HashMap;
importjava.util.Map;
importjava.util.Random;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
importorg.springframework.remoting.RemoteAccessException;
importorg.springframework.stereotype.Service;

/**
 * This service mimics a remote webservice/RMI
 * whose response is not guaranteed.
 * 
 * @author hemant
 *
 */
@Service
publicclassDummyRemoteClientServiceImplimplementsRemoteClientService {
	
	privatestaticfinal Logger LOG = LoggerFactory.getLogger(DummyRemoteClientServiceImpl.class);
	privatefinal Random random = new Random();
	
	/*** This mimics the response of unreliable service.
	 * Here we use {@code java.util.Random} so that
	 * it returns success sometimes as well as failure sometimes
	 * 
	 * The random number generates {0,1,2,3} with equal probablity
	 * When random = 0, successful response is returned
	 * Else, it throws {@code org.springframework.remoting.RemoteAccessException}
	 * 
	 * Thus the success probablity = 25%
	 * 
	 * @return
	 */
	@Override
	public Map<String, String>getValueForKey(String key) {
		intnum = random.nextInt(4);
		LOG.info("The random number is :{}", num);
		if(num != 0) {
			LOG.error("The random number is {} NOT 0. Hence throwing exception", num);
			thrownewRemoteAccessException("The random number " + num + " is NOT 0");
		}
		LOG.info("The random number is 0. Hence returning the response");
		Map<String, String> map = newHashMap<>();
		String value = key + random.nextDouble();
		LOG.info("The value for the key :{} is {}", key, value);
		map.put(key, value);
		return map;
	}
}

</xmp>
			<p><b>2.3.2 Application Service</b></p>
			<p>The application service uses the API of the RemoteClientService.Since the API is unreliable, the method calling it is annotated with @Retryable. The retry config is </p>
			<p>1.	Retry when the implementation throws RuntimeException or any its subclass</p>
			<p>2.	Retry the code 3 times upon failure</p>
			<p>3.	Next retry is made after a delay of 1000 msie 1 sec</p>
			<p>Also it has 1 more method, ie fallback method.</p>
			<p>This method is called automatically when all the retries are exhausted.
			The signature of this method is same as the method annotated with @Retryable.
			</p>
			<p>1.	This method is annotated with @Recover</p>
			<p>2.	The return type is same as method with @Retryable</p>
			<p>3.	The arguments here are arguments for method with @Retryable + the exception.</p>
<xmp>
packagecom.hemant.springretry.service.app;

importjava.util.Map;

importorg.springframework.retry.annotation.Backoff;
importorg.springframework.retry.annotation.Recover;
importorg.springframework.retry.annotation.Retryable;

/**
 * Application service
 * @author hemant
 *
 */
publicinterfaceApplicationService {

	/**
	 * This method consumes the API from RemoteClientService and sends it back
	 * We have declared this as retryable with following config :
	 * 
	 * <ul>
	 * <li> 1. Retry when the implementation throws RuntimeException or any its subclass
	 * <li> 2. Retry the code 3 times upon failure
	 * <li> 3. Next retry is made after a delay of 1000 msie 1 sec
	 * </ul>
	 */
	@Retryable(
			value = { RuntimeException.class },
			maxAttempts = 3,
			backoff = @Backoff(delay = 1000))
	Map<String, String>getValueForKey(String key);

	/*** This method is a fallback method for 
	 * #{com.hemant.springretry.service.app.ApplicationService.getValueForKey()}
	 * 
	 * Following are the things to note :
	 * <ul>
	 * <li> 1. The signature of this method is same as the method with @Retryable
	 *      as return type is same.
	 * <li> 2. Its arguements follow the order (Throwable t, args of the method with retryAble)
	 * </ul>
	 * 
	 * @param e
	 * @return
	 */
	@Recover
	Map<String, String>getValueForKeyFallback(RuntimeException e, String key);

}
</xmp>
<p>The implementation of the interface :</p>
<xmp>
packagecom.hemant.springretry.service.app;

importjava.util.HashMap;
importjava.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
importorg.springframework.beans.factory.annotation.Autowired;
importorg.springframework.stereotype.Service;

importcom.hemant.springretry.service.remote.RemoteClientService;

/**
 * This is a component at application end which uses the
 * RemoteClientServiceAPIs
 * 
 * @author hemant
*
 */
@Service
publicclassApplicationServiceImplimplementsApplicationService {
	privatestaticfinal Logger LOG = LoggerFactory.getLogger(ApplicationServiceImpl.class);

	@Autowired
	privateRemoteClientServiceremoteClientService;

	/**
	 * This method consumes the API from RemoteClientService and sends it back
	 */
	@Override
	public Map<String, String>getValueForKey(String key) {
		returnremoteClientService.getValueForKey(key);
	}

	/**
	 * This method is a fallback method for 
	 * #{com.hemant.springretry.service.app.ApplicationService.getValueForKey()}
	 */
	@Override
	public Map<String, String>getValueForKeyFallback(RuntimeException e, String key) {
		LOG.warn("All retries were exhausted. Hence recover method is called. Returning fallback value");
		Map<String, String> map = newHashMap<>();
		map.put(key, "FALL BACK VALUE");
		return map;
	}
}

</xmp>
<p><b>2.3.3 Controller</b></p>
<p>The Rest Controller exposes the single API (/lookup), which accepts a key and then calls the applicationService to get its value (which in-turn calls the RemoteClientService).</p>
<xmp>
packagecom.hemant.springretry.web;

importjava.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
importorg.springframework.beans.factory.annotation.Autowired;
importorg.springframework.web.bind.annotation.RequestMapping;
importorg.springframework.web.bind.annotation.RequestMethod;
importorg.springframework.web.bind.annotation.RequestParam;
importorg.springframework.web.bind.annotation.RestController;

importcom.hemant.springretry.service.app.ApplicationService;



/**
 * The controller exposing the application API
 * @author hemant
 *
 */
@RestController
publicclassLookupController {
	
	privatestaticfinal Logger LOG = LoggerFactory.getLogger(LookupController.class);

	@Autowired
	privateApplicationServiceapplicationService;
	
	/**
	 * Gets the key value for the given parameter
	 * @param key
	 * @return
	 */
	@RequestMapping(value="/lookup", method = RequestMethod.GET)
	public Map<String, String>getValueForKey(
			@RequestParam String key) {
		LOG.info("The KEY parameter recieved is {}", key);
		returnapplicationService.getValueForKey(key);
	}
}

</xmp>
			<p><b>2.3.4 Main Application class</b><p>
			<p>The main application is :</p>
			<p>1.	Annotated with annotation @SpringBootApplicationindicating that it is main class for spring boot</p>
			<p>2.	Also annotated with @EnableRetry indicating spring to enable retry config</p>
<xmp>
packagecom.hemant.springretry;
importorg.springframework.boot.SpringApplication;
importorg.springframework.boot.autoconfigure.SpringBootApplication;
importorg.springframework.retry.annotation.EnableRetry;
@SpringBootApplication
@EnableRetry
publicclassSpringRetryApplication {

	publicstaticvoidmain(String[] args) {
		SpringApplication.run(SpringRetryApplication.class, args);
	}
}

</xmp>
<p><b>2.3.5 Application properties file</b></p>
<p>Spring boot gets its properties from default application.properties file in src/main/resources directory.</p>

<xmp>
# IDENTITY (ContextIdApplicationContextInitializer)
spring.application.name= spring-retry
# Server HTTP port.
server.port=8080

#logging pattern
logging.pattern.console=%d{HH:mm:ss} %-5level %logger{10} - %msg%n
#since we need to look closer at retry library logs
logging.level.org.springframework.retry=DEBUG

</xmp>

			<h3>3. Executing The Project</h3>
			<p><b>3.1 Running the application</b></p>
			<p>1.	Run the main application class <i>(SpringRetryApplication.java)</i> as Java Application in IDE (Eclipse/IntelliJ) OR</p>
			<p>2.	If you want to run it from terminal, then </p>
			<p>&nbsp; &nbsp; a. Go to root directory, execute “mvn clean install”. This will create the jar in /target child directory.</p>
			<p>&nbsp; &nbsp; b. Execute the jar as <b>“java -jar target/spring-retry-0.0.1-SNAPSHOT.jar ”</b></p>
			<p>3. Once the application is started, its endpoints can be called.</p>
			<h3>3.2  Execution use cases</h3>
			<p><b>3.2.1 Successful call without retries :</b></p>

			<p>In this case, the first call to remote service is success, the logs and response are as follows :</p>

<xmp>
23:05:48INFO  c.h.s.w.LookupController - The KEY parameter recieved is 123
23:05:48 DEBUG o.s.r.s.RetryTemplate - Retry: count=0
23:05:48 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :0
23:05:48 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl- The random number is 0. Hence returning the response
23:05:48 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The value for the key :123 is 1230.28348079448241803

GET http://localhost:8080/lookup?key=123

Response :
{
"123": "1230.28348079448241803"
}
</xmp>
<p><b>3.2.2 Initial call fail but we got success in next attempts</b></p>
<p>In this case, the first call fails, but subsequent retry attempts fetches the response.</p>
<xmp>
23:23:02INFO  c.h.s.w.LookupController - The KEY parameter recieved is 123
23:23:02 DEBUG o.s.r.s.RetryTemplate - Retry: count=0
23:23:02 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :3
23:23:02 ERROR c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is 3 NOT 0. Hence throwing exception
23:23:03 DEBUG o.s.r.s.RetryTemplate - Checking forrethrow: count=1
23:23:03 DEBUG o.s.r.s.RetryTemplate - Retry: count=1
23:23:03INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :0
23:23:03 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is 0. Hence returning the response
23:23:03 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The value for the key :123 is 1230.8441210232646286
GET http://localhost:8080/lookup?key=123

Response :
{
"123": "1230.8441210232646286"
}
</xmp>
<p><b>3.2.3 When all retries fail:</b></p>
<p>Here the first call as well as subsequent retry attempts fail.
Hence at the end the fallback method is called (one annotated with @Recover) which sends the fallback response to client.
</p>
<xmp>
23:36:28 INFO  o.a.c.c.C.[.[.[/] - Initializing Spring FrameworkServlet'dispatcherServlet'
23:36:28 INFO  o.s.w.s.DispatcherServlet - FrameworkServlet'dispatcherServlet': initialization started
23:36:28 INFO  o.s.w.s.DispatcherServlet - FrameworkServlet'dispatcherServlet': initialization completed in 30ms
23:36:28 INFO  c.h.s.w.LookupController - The KEY parameter recieved is 123
23:36:28 DEBUG o.s.r.s.RetryTemplate - Retry: count=0
23:36:28 INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :1
23:36:28 ERROR c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is 1 NOT 0. Hence throwing exception
23:36:29 DEBUG o.s.r.s.RetryTemplate - Checking forrethrow: count=1
23:36:29 DEBUG o.s.r.s.RetryTemplate - Retry: count=1
23:36:29INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :1
23:36:29 ERROR c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is 1 NOT 0. Hence throwing exception
23:36:30 DEBUG o.s.r.s.RetryTemplate - Checking forrethrow: count=2
23:36:30 DEBUG o.s.r.s.RetryTemplate - Retry: count=2
23:36:30INFO  c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is :3
23:36:30 ERROR c.h.s.s.r.DummyRemoteClientServiceImpl - The random number is 3 NOT 0. Hence throwing exception
23:36:30 DEBUG o.s.r.s.RetryTemplate - Checking forrethrow: count=3
23:36:30 DEBUG o.s.r.s.RetryTemplate - Retry failed last attempt: count=3
23:36:30WARN  c.h.s.s.a.ApplicationServiceImpl - All retries were exhausted. Hence recover method is called. Returning
fallback value
GET http://localhost:8080/lookup?key=123

Response :
{

"123": "FALL BACK VALUE"
}
</xmp>

<h3>4. Conclusion</h3>
<p>Thus we have created a <a href="../technologies/java-application-development.html"><b>java application development</b></a>  using spring-retry which provides us a declarative way to handle retries more efficiently.</p>

<h3>Read More</h3>
<ul class="listing">
	<li> <a href="https://www.nexsoftsys.com/articles/java-spring-cloud-data-flow.html">Spring Cloud Data flow</a></li>
</ul>
        <div class="Clear">&nbsp;</div>
        
        
    </div><!--Page-Size-->


<div id="nss-note"><img src="../images/nss.jpg" alt="NSS Note"/></div>
    
    <div class="Clear"></div>
    
</div>
    
	<div class="clients-section margin_top30">
		<div class="section-header ourclients">
			<h4>Some of our clients</h4>
		</div>	
		<div class="container">
			<div class="clients-block owl-carousel owl-theme">
				<div class="item client1"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client2"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client3"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client4"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client5"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client8"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client9"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client10"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client11"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client15"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client16"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client17"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client12"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client13"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client14"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client6"><img src="../images/spacer.gif" alt="client" /></div>
				<div class="item client7"><img src="../images/spacer.gif" alt="client" /></div>
			</div>
		</div>	
	</div>
	<div class="teams-section">
		<div class="container">
			<div class="teams-title">
				<img data-src="../images/team-title.svg" class="lazyload" alt="team" />
			</div>
		</div>
	</div>
    
	<!-- Footer -->
	<footer class="footer-main">
		<div class="container">
			<div class="row">
				<div class="footer-box">
					<h3>Services</h3>
					<div class="footer-innerbox-block">
						<div class="footer-innerbox">
							<ul class="listing">
								<li><a href="../services/application-development.html">Application Development</a></li>
								<li><a href="#">Digital Transformation</a></li>
								<li><a href="../services/software-consulting-services.html">Software Consulting Services</a></li>
								<li><a href="../services/software-it-outsourcing-services.html">Software IT Outsourcing</a></li>
								<li><a href="../services/offshore-development-center.html">Offshore Development</a></li>
								<li><a href="../services/big-data-services.html">Big Data</a></li>
								<li><a href="../services/real-time-data-analytics-services.html">Real Time Analytics</a></li>
								<li><a href="#">Block Chain</a></li>
								<li><a href="../services/devops-consulting.html">DevOps</a></li>
							</ul>
						</div>
						<div class="footer-innerbox">
							<ul class="listing">
								<li><a href="../services/offshore-qa-testing-services.html">QA and Testing Services</a></li>
								<li><a href="../services/amazon-cloud-services.html">Amazon Cloud Services</a></li>
								<li><a href="../services/cloud-application-development.html">Cloud Application</a></li>
								<li><a href="../services/mobility-solutions.html">Enterprise Mobility</a></li>
								<li><a href="#">Business Intelligence</a></li>
								<li><a href="../services/data-warehousing-solutions.html">Data ware Housing</a></li>
								<li><a href="#">Data Integration</a></li>
								<li><a href="../services/ETL-data-integration-services.html">ETL</a></li>
								<li><a href="#">Dashboards</a></li>
							</ul>
						</div>
					</div>
				</div>
				<div class="footer-box">
					<h3>Technologies</h3>
					<div class="footer-innerbox w35">
						<ul class="listing">
							<li><a href="../technologies/java-application-development.html">Java</a></li>
							<li><a href="../technologies/python-development-services.html">Python</a></li>
							<li><a href="../technologies/scala-development.html">Scala</a></li>
							<li><a href="../technologies/magento-ecommerce.html">Magento</a></li>
							<li><a href="../technologies/android-app-development.html">Android</a></li>
							<li><a href="../technologies/ios-application-development.html">iOS</a></li>
							<li><a href="../technologies/pentaho-BI-Services.html">Pentaho BI</a></li>
						</ul>
					</div>
					<div class="footer-innerbox w65">
						<ul class="listing">
							<li class="list-title"><strong>Microsoft</strong></li>
							<li><a href="../technologies/net-application-development.html">.Net Development</a></li>
							<li><a href="../technologies/microsoft-dynamics-365.html">Dynamics 365</a></li>
							<li><a href="../technologies/dynamics-365-business-central-solutions-development.html">Dynamics 365 Business Central</a></li>
							<li><a href="../technologies/dynamics365-finance-and-operations.html">Dynamics 365 Finance &amp; Operations</a></li>
							<li><a href="../technologies/microsoft-dynamics-crm-consulting.html">Dynamics CRM</a></li>
							<li><a href="#">Power BI</a></li>
						</ul>
					</div>
				</div>
				<div class="footer-box footer_sm">
					<div class="footer-box-business">
						<h3>Business with us</h3>
                        <ul class="listing">
                            <li><a href="../company.html">Company</a></li>
                            <li><a href="../contact.html">Contact Us</a></li>
                            <li><a href="../careers.html">Careers</a></li>
                            <li><a href="/articles/">Blog</a></li>
                            <li><a href="mailto:info@nexsoftsys.com">Mail Us</a></li>
                        </ul>
						<div class="footer-socialbox">
							<h3>Follow NEX</h3>
							<div class="ft-social">
								<a href="https://www.facebook.com/NexSoftSys/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
								<a href="https://twitter.com/nexsoftsys" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
								<a href="https://www.linkedin.com/company/nexsoftware/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                                <a href="https://www.youtube.com/c/Nexsoftsys" target="_blank"><i class="fa fa-youtube-play" aria-hidden="true"></i></a>
							</div>
						</div>
					</div>
				</div>
			<div class="ast"><p>An Aegis Group Company</p><span></span></div>
            </div>
        </div>
        <div class="copyright_text">
            <div class="copyright_text">
                <div class="container footer-rating">
                    <p>Copyright &copy; <span id="year"></span> NEX Software All rights reserved</p>
                </div>
            </div>
        </div>
	</footer><!-- Footer /- -->
	
<script defer src="../js/jquery-1.12.4.min.js"></script>
<script defer src="../js/lib.js"></script>
<script defer src="js/functions.js"></script>


    
</body>
</html>